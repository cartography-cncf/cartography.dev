import { ImageResponse } from "next/og";
import { getPostMeta, getAllPostSlugs } from "@/lib/blog";

export const alt = "Cartography Blog";
export const size = { width: 1200, height: 630 };
export const contentType = "image/png";

export function generateStaticParams() {
  const slugs = getAllPostSlugs();
  return slugs.map((slug) => ({ slug }));
}

function formatDate(dateString: string): string {
  const date = new Date(dateString + "T00:00:00");
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}

export default async function OGImage({
  params,
}: {
  params: { slug: string };
}) {
  const post = getPostMeta(params.slug);

  if (!post) {
    return new ImageResponse(
      (
        <div
          style={{
            width: "100%",
            height: "100%",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            backgroundColor: "#f5f5f5",
            fontSize: 48,
            fontFamily: "sans-serif",
          }}
        >
          Cartography Blog
        </div>
      ),
      size
    );
  }

  return new ImageResponse(
    (
      <div
        style={{
          width: "100%",
          height: "100%",
          display: "flex",
          flexDirection: "column",
          justifyContent: "space-between",
          backgroundColor: "#fafafa",
          fontFamily: "sans-serif",
          padding: "60px 80px",
        }}
      >
        {/* Top bar */}
        <div
          style={{
            display: "flex",
            alignItems: "center",
            gap: "16px",
          }}
        >
          {/* Cartography icon as inline SVG */}
          <svg
            width="40"
            height="40"
            viewBox="0 0 100.6 98.1"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M48.2,49.5c-.1-.5-.2-1.1-.3-1.6,0-.2,0-.5,0-.7,0-.4-.1-.9-.2-1.3,0-.3,0-.5,0-.8,0-.4,0-.8,0-1.3v-.8c0-.4,0-.8,0-1.2,0-.3,0-.6,0-.8,0-.4,0-.8.2-1.3,0-.3,0-.5.1-.8,0-.5.2-.9.3-1.4,0-.2,0-.4.1-.7.2-.7.3-1.3.6-2,2.8-8.5,9.5-15.3,18-18,.6-.2,1.3-.4,1.9-.5.2,0,.4,0,.6-.1.5-.1.9-.2,1.4-.3.2,0,.4,0,.6-.1.6,0,1.2-.2,1.8-.2,0,0,.1,0,.2,0h0C69.6,6.1,60.5,0,50.3,0s-20.5,6.9-23.8,17.3h0c-.6,1.9-1,3.8-1.1,5.8,0,.6,0,1.3,0,2,0,8,3.9,15.6,10.3,20.3.5.4,1,.7,1.5,1,.2.1.4.2.5.3.4.2.7.4,1.1.6.2.1.4.2.7.3.3.2.7.3,1,.5.2,0,.5.2.7.3.3.1.7.3,1,.4.2,0,.5.2.7.2.4.1.7.2,1.1.3.2,0,.5.1.7.2.4,0,.8.2,1.2.2.2,0,.4,0,.6.1.6,0,1.2.2,1.8.2,0,0,0,0,0,0,0-.2,0-.3,0-.5h0Z"
              fill="#171717"
            />
            <path
              d="M47.7,53c-.5,0-1.1-.1-1.6-.2-.2,0-.5,0-.8-.1-.4,0-.9-.2-1.3-.3-.3,0-.5-.1-.8-.2-.4,0-.8-.2-1.2-.3-.3,0-.5-.2-.8-.3-.4-.1-.8-.3-1.2-.4-.3,0-.5-.2-.8-.3-.4-.2-.8-.3-1.2-.5-.2-.1-.5-.2-.7-.3-.4-.2-.8-.5-1.2-.7s-.4-.2-.6-.3c-.6-.4-1.2-.8-1.7-1.2-7.2-5.3-11.6-13.8-11.6-22.7s0-1.3,0-2c0-.2,0-.4,0-.6,0-.5.1-1,.2-1.4,0-.2,0-.4,0-.6.1-.6.2-1.2.3-1.7,0,0,0-.1,0-.2h0c-10,.7-18.7,7.5-21.8,17.2-3.4,10.3.3,21.6,9.1,28,2.1,1.6,4.5,2.8,7,3.6,7.6,2.5,16,1.1,22.5-3.6.5-.4,1-.8,1.5-1.2.2-.1.3-.3.5-.4.3-.3.6-.6.9-.8.2-.2.3-.3.5-.5.3-.3.5-.5.8-.8.2-.2.3-.4.5-.6.2-.3.5-.6.7-.9.2-.2.3-.4.4-.6.2-.3.4-.6.6-1,.1-.2.3-.4.4-.6.2-.4.4-.7.6-1.1,0-.2.2-.3.3-.5.3-.5.5-1.1.8-1.7h-.5c0,0,0,0,0,0Z"
              fill="#171717"
            />
            <path
              d="M51.6,48.9c.5-.3.9-.5,1.4-.8.2-.1.5-.2.7-.3.4-.2.8-.4,1.2-.5.3-.1.5-.2.8-.3.4-.2.8-.3,1.2-.4.3,0,.5-.2.8-.3.4-.1.8-.2,1.2-.3.3,0,.5-.1.8-.2.4,0,.8-.2,1.2-.2.3,0,.5,0,.8-.1.5,0,.9-.1,1.4-.2.2,0,.5,0,.7,0,.7,0,1.4,0,2.1,0h0c9,0,17.4,4.3,22.7,11.6.4.5.8,1.1,1.1,1.7,0,.2.2.3.3.5.2.4.5.8.7,1.3,0,.2.2.4.3.5.3.5.5,1.1.7,1.6,0,0,0,.1,0,.2,0,0,0,0,0,0,7.7-6.5,10.7-17,7.5-26.8-3.4-10.4-12.9-17.3-23.8-17.3h0c-2,0-3.9.2-5.8.7-.6.1-1.3.3-1.9.5-7.6,2.5-13.6,8.5-16.1,16.1-.2.6-.4,1.2-.5,1.8,0,.2,0,.4-.1.6,0,.4-.2.8-.2,1.2,0,.2,0,.5,0,.7,0,.4,0,.8-.1,1.1,0,.2,0,.5,0,.7,0,.4,0,.8,0,1.1v.7c0,.4,0,.8,0,1.2,0,.2,0,.5,0,.7,0,.4,0,.8.2,1.3,0,.2,0,.4,0,.6,0,.6.2,1.2.4,1.8,0,0,0,0,0,0,.1,0,.3-.2.4-.2h0Z"
              fill="#171717"
            />
            <path
              d="M53.2,52c.4.3.8.7,1.2,1.1s.3.4.5.5c.3.3.6.6.9,1,.2.2.3.4.5.6.3.3.5.7.8,1,.2.2.3.5.5.7.2.3.5.7.7,1,.2.2.3.5.4.7.2.4.4.7.6,1.1.1.2.3.5.4.7.2.4.4.8.6,1.3,0,.2.2.4.3.6.3.6.5,1.3.7,2,2.8,8.5,1.3,17.9-4,25.2-.4.5-.8,1.1-1.2,1.6-.1.2-.3.3-.4.4-.3.4-.7.7-1,1.1-.1.2-.3.3-.4.4-.4.4-.8.8-1.3,1.2,0,0-.1.1-.2.2,0,0,0,0,0,0,8.6,5.3,19.5,4.9,27.8-1.1,8.8-6.4,12.5-17.7,9.1-28-.8-2.5-2-4.8-3.6-7-4.7-6.5-12.3-10.3-20.3-10.3h0c-.6,0-1.2,0-1.9,0-.2,0-.4,0-.6,0-.4,0-.8,0-1.2.2-.2,0-.5,0-.7.1-.4,0-.8.1-1.1.2-.2,0-.5.1-.7.2-.4,0-.7.2-1.1.3-.2,0-.5.2-.7.2-.4.1-.7.2-1.1.4-.2,0-.4.2-.7.3-.4.2-.8.3-1.1.5-.2,0-.4.2-.5.3-.5.3-1.1.6-1.6.9,0,0,0,0,0,0,.1.1.2.2.4.3h0Z"
              fill="#171717"
            />
            <path
              d="M50.8,54.6c-.2.5-.4,1-.7,1.4-.1.2-.2.5-.4.7-.2.4-.4.8-.6,1.1-.1.2-.3.5-.4.7-.2.3-.5.7-.7,1-.2.2-.3.5-.5.7-.2.3-.5.7-.8,1-.2.2-.4.4-.5.6-.3.3-.6.6-.9.9-.2.2-.4.4-.6.6-.3.3-.7.6-1,1-.2.2-.3.3-.5.4-.5.4-1.1.9-1.7,1.3-.5.4-1.1.8-1.7,1.1-.2,0-.3.2-.5.3-.4.2-.9.5-1.3.7-.2,0-.3.2-.5.3-.6.3-1.2.6-1.8.8,0,0,0,0,0,0-.6.2-1.2.5-1.8.7-.2,0-.4.1-.6.2-.5.1-.9.3-1.4.4-.2,0-.4,0-.5.1-.6.2-1.3.3-1.9.4,0,0-.1,0-.1,0-.6,0-1.2.2-1.8.2-.2,0-.4,0-.6,0-.5,0-1,0-1.5,0-.1,0-.2,0-.4,0h-.2c-.6,0-1.3,0-2,0,0,0-.1,0-.2,0-.6,0-1.2-.1-1.8-.2-.2,0-.4,0-.6,0-.5,0-1-.2-1.4-.3-.2,0-.4,0-.6-.1-.6-.2-1.3-.3-1.9-.5-.6-.2-1.2-.4-1.9-.7-.2,0-.4-.2-.6-.2-.4-.2-.9-.4-1.3-.6-.2,0-.4-.2-.6-.3-.5-.3-1-.6-1.5-.9,0,0-.1,0-.2-.1,0,0,0,0,0,0-2.3,9.8,1.4,20.1,9.6,26.1,8.8,6.4,20.6,6.4,29.5,0,2.1-1.6,4-3.4,5.5-5.5,4.7-6.5,6-14.9,3.5-22.5-.2-.6-.4-1.2-.6-1.8,0-.2-.2-.4-.2-.6-.2-.4-.3-.8-.5-1.1-.1-.2-.2-.4-.3-.6-.2-.3-.4-.7-.6-1-.1-.2-.3-.4-.4-.6-.2-.3-.4-.6-.6-.9-.1-.2-.3-.4-.4-.6-.2-.3-.5-.6-.7-.9-.2-.2-.3-.4-.4-.5-.3-.3-.6-.6-.9-.9-.1-.1-.3-.3-.4-.4-.4-.4-.9-.8-1.4-1.2,0,0,0,0,0,0,0,.2-.1.3-.2.5h0Z"
              fill="#171717"
            />
          </svg>
          <span
            style={{
              fontSize: 24,
              color: "#737373",
              fontWeight: 500,
            }}
          >
            Cartography Blog
          </span>
        </div>

        {/* Title */}
        <div
          style={{
            display: "flex",
            flexDirection: "column",
            gap: "16px",
            flex: 1,
            justifyContent: "center",
          }}
        >
          <div
            style={{
              fontSize: post.title.length > 60 ? 40 : 52,
              fontWeight: 700,
              color: "#171717",
              lineHeight: 1.2,
              maxWidth: "1000px",
            }}
          >
            {post.title}
          </div>
          {post.summary && (
            <div
              style={{
                fontSize: 22,
                color: "#737373",
                lineHeight: 1.4,
                maxWidth: "900px",
              }}
            >
              {post.summary.length > 140
                ? post.summary.slice(0, 140) + "..."
                : post.summary}
            </div>
          )}
        </div>

        {/* Bottom meta */}
        <div
          style={{
            display: "flex",
            alignItems: "center",
            gap: "16px",
            fontSize: 20,
            color: "#737373",
          }}
        >
          <span>{formatDate(post.date)}</span>
          {post.author && (
            <>
              <span style={{ color: "#d4d4d4" }}>Â·</span>
              <span>{post.author}</span>
            </>
          )}
        </div>
      </div>
    ),
    size
  );
}
